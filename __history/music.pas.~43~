unit music;

interface

uses FMX.Media,system.Classes,FMX.Dialogs,SysUtils,FMX.Forms,system.IOUtils;

type mc = class

    public

    procedure PlayMusic(ResName,ResType, ResNewName: string);
    procedure SetMPlayerVolume(mp : TMediaPlayer;volume :single);
    procedure ExtractRes(ResName,ResType, ResNewName: string);
    procedure readCardNumber(cards :Tarray<string>;ty :integer);
    procedure UnPackBgmDic();

    constructor Create();
    destructor Destory();
end;

var BC :mc;

implementation


uses game,goos;

constructor mc.Create();
begin

  showmessage(Tpath.GetDocumentsPath);

//  if not DirectoryExists(Tpath.GetDocumentsPath+PathDelim+'bgm')  then
//   begin
//     createDir(Tpath.GetDocumentsPath+PathDelim+'bgm');
//   end;
//    playMusic('SRC1','FILE1','1.mp3');
    UnPackBgmDic();
end;

destructor mc.Destory();
begin

end;

procedure mc.UnPackBgmDic();
var
    SM, DM: TMemoryStream;
begin
  SM := TMemoryStream.Create;
//  DM := TMemoryStream.Create;
  try
    Sm.LoadFromFile(Tpath.GetDocumentsPath+PathDelim+'Woman.zip');
//    SM.Position := 0;
//    UnCompressit(sm, dm);
//    dm.Position := 0;
    SM.SaveToFile(Tpath.GetDocumentsPath+PathDelim+'Woman');
    finally
    SM.Free;
//    DM.Free;
    end;
end;

procedure mc.PlayMusic(ResName,ResType, ResNewName: string);
begin

 if not fileExists(Tpath.GetDocumentsPath+PathDelim+'bgm'+PathDelim+ResNewName) then
  begin
      if goos.currentSystem='Windows' then
      begin
        ExtractRes(ResName,ResType,ResNewName);
      end
      else
      begin

      end;

  end;
  GameInterface.MediaPlayer1.FileName:=Tpath.GetDocumentsPath+PathDelim+'bgm'+PathDelim+ResNewName;
  GameInterface.MediaPlayer1.Play;

end;


 procedure mc.ExtractRes(ResName,ResType, ResNewName: string);   //释放资源文件
var
    Res: TResourceStream;
begin
  Res := TResourceStream.Create(Hinstance, Resname, Pchar(ResType));
  Res.SaveToFile(Tpath.GetDocumentsPath+PathDelim+'bgm'+PathDelim+ResNewName);
  Res.Free;
end;


procedure mc.readCardNumber(cards : Tarray<string>;ty :integer);
//var
// str : string;
begin
 case length(cards) of
   0:
   begin

   end;
   1:
   begin
   delete(cards[0],1,1);
    playMusic('SRC'+cards[0],'FILE'+cards[0],cards[0]+'.mp3');
//    playMusic('cards[0]'+'.mp3');
   end;
 end;

end;



procedure mc.SetMPlayerVolume(mp :TMediaPlayer;volume : single);
begin
    mp.Volume:=volume;
end;

end.

